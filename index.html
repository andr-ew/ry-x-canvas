<!DOCTYPE html>
<html>
    <head>
        <title>Noise Points</title>
        <script src="https://cdn.jsdelivr.net/npm/noisejs@latest"></script>
        <style>
            body {
                margin: 0;
                background-color: rgb(253, 243, 240);
            }

            #canvas1 {
                width: calc(14px * 23);
                height: calc(14px * 23);
                position: absolute;
                top: 50vh;
                left: 50vw;
                transform: translate(-50%, -50%);
            }
        </style>
    </head>
    <body>
        <canvas id="canvas1"></canvas>
        <script>
            var noise = new Noise(Math.random());

            const canvas = document.getElementById('canvas1');
            const ctx = canvas.getContext('2d');

            const gap = 14;
            const countSq = 35;
            const offsetAmp = 100;

            const traversal = 0.07;
            const zstep = 0.3;

            function resize() {
                canvas.width = 14 * 23;
                canvas.height = 14 * 23;
            }

            window.addEventListener('resize', resize);

            let offsets = Array(countSq * countSq);
            let z = 0;
            let tLast = Date.now();

            function animate() {
                const dt = Date.now() - tLast;

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (i = 0; i < countSq * countSq; i++) {
                    const x = i % countSq;
                    const y = Math.floor(i / countSq);
                    //offsets[i] = Math.random() * 2 - 1;
                    offsets[i] = {
                        x: noise.perlin3(x * traversal, y * traversal, z),
                        //y: noise.simplex3(x * traversal, y * traversal, z),
                    };
                }

                z += zstep * (dt / 1000);

                for (x = 0; x < countSq; x++) {
                    for (y = 0; y < countSq; y++) {
                        const off = offsets[y * countSq + x];

                        ctx.fillStyle = `hsl(${0.48 * 360}, 100%, 50%)`;
                        ctx.beginPath();
                        ctx.arc(
                            canvas.width / 2 +
                                (x - countSq / 2) * gap -
                                gap / 2 +
                                off.x * offsetAmp,
                            canvas.height / 2 +
                                (y - countSq / 2) * gap -
                                gap / 2 +
                                off.x * offsetAmp,
                            2,
                            0,
                            Math.PI * 2
                        );
                        ctx.fill();
                    }
                }

                tLast = Date.now();
                requestAnimationFrame(animate);
            }

            resize();
            animate();
        </script>
    </body>
</html>
